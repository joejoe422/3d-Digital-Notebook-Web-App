<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Two-Page Digital Notebook</title>
<style>
  body {
    background-color: #333;
    color: #eee;
    font-family: sans-serif;
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    min-height: 100vh;
  }
  .notebook-container {
    display: flex;
    align-items: stretch;
    background-color: #444;
    padding: 20px;
    margin-top: 20px;
  }
  .page {
    background: #fdfdfd;
    border: 1px solid #ccc;
    border-radius: 4px;
    padding: 20px;
    margin: 0 10px;
    box-shadow: 2px 2px 5px rgba(0,0,0,0.3);
    width: 300px;
    min-width: 200px;
    color: #222;
    max-height: 400px;
    overflow-y: auto;
  }
  .spine {
    width: 20px;
    background: #555;
    border-radius: 2px;
    box-shadow: inset 0 0 5px rgba(0,0,0,0.5);
    margin: 0 5px;
  }
  button.save {
    margin: 20px;
    padding: 10px 20px;
    background: #4caf50;
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    cursor: pointer;
  }
  button.save:hover { background: #45a049; }
  #notesContainer {
    width: 90%;
    max-width: 700px;
    margin: 20px auto;
    background: #444;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 2px 2px 5px rgba(0,0,0,0.3);
  }
  .note-item {
    background: #fdfdfd;
    margin-bottom: 10px;
    padding: 10px;
    border-radius: 4px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    color: #222;
  }
  .note-item button {
    margin-left: 5px;
    padding: 5px 10px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
  }
  .btn-load { background: #2196f3; color: white; }
  .btn-delete { background: #e53935; color: white; }
</style>
</head>
<body>
  <h1>ðŸ“’ Two-Page Digital Notebook</h1>
  <div class="notebook-container">
    <div class="page left" contenteditable="true" id="leftPage"></div>
    <div class="spine" id="spine"></div>
    <div class="page right" contenteditable="true" id="rightPage"></div>
  </div>

  <button class="save" id="saveBtn">ðŸ’¾ Save Note</button>

  <div id="notesContainer">
    <h2 style="color: white;">ðŸ“š Saved Notes</h2>
    <!-- Notes will be injected here -->
  </div>

<script>
function adjustSpineHeight() {
  const left = document.getElementById('leftPage');
  const right = document.getElementById('rightPage');
  const spine = document.getElementById('spine');
  const maxHeight = Math.max(left.scrollHeight, right.scrollHeight);
  spine.style.height = maxHeight + 'px';
}
document.querySelectorAll('.page').forEach(p => p.addEventListener('input', adjustSpineHeight));
window.addEventListener('resize', adjustSpineHeight);
window.addEventListener('load', adjustSpineHeight);
</script>

<script type="module">
import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'

const supabaseUrl = 'https://pbclnujukutrpmirljjk.supabase.co';
const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBiY2xudWp1a3V0cnBtaXJsamprIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDU2MTE3NzIsImV4cCI6MjA2MTE4Nzc3Mn0.ZLaVbsKFdfYv2vZFEyrURjSILE3F890Skmtd3HmB-BA';
const supabase = createClient(supabaseUrl, supabaseKey);

// Save or update a note
async function saveNote() {
  const leftContent = document.getElementById('leftPage').innerText;
  const rightContent = document.getElementById('rightPage').innerText;
  if (!leftContent.trim() && !rightContent.trim()) {
    alert('Please enter text on at least one page.');
    return;
  }

  const { data, error } = await supabase
    .from('2 notes')
    .insert([{ left_page: leftContent, right_page: rightContent }]);

  if (error) {
    console.error('Error saving:', error);
    alert('Error saving: ' + error.message);
  } else {
    alert('Note saved!');
    loadNotes();
  }
}

document.getElementById('saveBtn').addEventListener('click', saveNote);

// Load all saved notes
async function loadNotes() {
  const { data, error } = await supabase
    .from('2 notes')
    .select('*')
    .order('id', { ascending: false });

  if (error) {
    console.error('Error loading notes:', error);
    return;
  }

  const container = document.getElementById('notesContainer');
  // Remove old items (except the heading)
  container.querySelectorAll('.note-item').forEach(el => el.remove());

  data.forEach(note => {
    const div = document.createElement('div');
    div.className = 'note-item';
    div.innerHTML = `
      <span>Note #${note.id}</span>
      <div>
        <button class=\"btn-load\" onclick=\"loadNote(${note.id})\">Load</button>
        <button class=\"btn-delete\" onclick=\"deleteNote(${note.id})\">Delete</button>
      </div>
    `;
    container.appendChild(div);
  });
}

// Load a specific note into the pages
async function loadNote(id) {
  const { data, error } = await supabase
    .from('2 notes')
    .select('*')
    .eq('id', id)
    .single();

  if (error) {
    console.error('Error loading note:', error);
    return;
  }

  document.getElementById('leftPage').innerText = data.left_page || '';
  document.getElementById('rightPage').innerText = data.right_page || '';
  adjustSpineHeight();
}

// Delete a note
async function deleteNote(id) {
  if (!confirm('Delete note #' + id + '?')) return;
  const { error } = await supabase
    .from('2 notes')
    .delete()
    .eq('id', id);

  if (error) {
    alert('Error deleting: ' + error.message);
  } else {
    loadNotes();
  }
}

// Initial load of notes
loadNotes();
</script>
</body>
</html>
